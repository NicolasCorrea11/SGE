@page "/gestion/1"
@rendermode InteractiveServer
@inject CasoDeUsoUsuarioListar UsuarioListar
@inject CasoDeUsoUsuarioConsultaId UsuarioConsulta
@inject CasoDeUsoUsuarioEliminar CasoBaja
@inject NavigationManager Navigation
<PageTitle>SGE | Gestion</PageTitle>

<h3>Gestion de Usuarios</h3>
<table class="table">
  <thead>
    <tr>
      <th>ID</th>
      <th>Nombre</th>
      <th>Apellido</th>
      <th>Email</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    @foreach (Usuario u in usuarios)
    {
      <tr>
        <td>@u.Id</td>
        <td>@u.Nombre</td>
        <td>@u.Apellido</td>
        <td>@u.Email</td>
        <td>
          <button class="btn btn-primary">
            <NavLink class="nav-link text-white" href="@($"/usermod/{u.Id}")">Editar</NavLink>
          </button>
          @if (u.Id != 1)
          {
            <button class="btn btn-success">
              <NavLink class="nav-link text-white" href="@($"/adminperm/{u.Id}")">Permisos</NavLink>
            </button>
            <td>
              <button class="btn btn-danger nav-link text-white" @onclick="() => Eliminar(u.Id)">Eliminar</button>
            </td>
          }
        </td>
      </tr>
    }
  </tbody>
</table>
<button class="btn btn-secondary mt-2" @onclick="Volver">Volver al menu</button>
@error

@code {
  [Parameter] public int Id { get; set; }
  List<Usuario> usuarios = [];
  string error = "";

  protected override void OnInitialized()
  {
    usuarios = UsuarioListar.Ejecutar();
    StateHasChanged();
  }

  public void Eliminar(int id)
  {
    try
    {
      CasoBaja.Ejecutar(id);
      Navigation.NavigateTo($"gestion/1"); // REFRESH (NO LO HACE SOLO)
    }
    catch (Exception ex)
    {
      error = ex.Message;
    }
  }

  public void Volver()
  {
    Navigation.NavigateTo($"home/1");
  }

}