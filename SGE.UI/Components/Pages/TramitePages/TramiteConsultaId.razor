@page "/tramiteconsultaid"
@rendermode InteractiveServer
@inject CasoDeUsoUsuarioConsultaId UsuarioConsulta
@inject CasoDeUsoTramiteConsultaId CasoConsulta
@inject NavigationManager Navigation
<PageTitle>SGE | Tramites</PageTitle>

<h3>Consulta de Tramite por ID</h3>
<label for="idt">Id de tramite a consultar</label>
<input placeholder="ID a consultar" @bind="idTramite" class="mt-3 form-control" id="idt"><br>
<button class="btn btn-primary" @onclick="() => Consultar(idTramite)">Aceptar</button><br>
@if (visible)
{
  <table class="table">
    <thead>
      <tr>
        <th>ID</th>
        <th>ID del expediente</th>
        <th>Etiqueta</th>
        <th>Contenido</th>
        <th>Fecha de creacion</th>
        <th>Fecha de modificacion</th>
        <th>Ultimo usuario en modificarlo</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>@t.Id</td>
        <td>@t.ExpedienteId</td>
        <td>@t.Etiqueta</td>
        <td>@t.Contenido</td>
        <td>@t.FechayHoraCr</td>
        <td>@t.FechayHoraMod</td>
        <td>@t.IdUser</td>
      </tr>
    </tbody>
  </table>
}
<button class="btn btn-secondary mt-2" @onclick="Volver">Volver al menu</button>
<br>
<CuadroDialogo @ref=dialogo Mensaje=@error />

@code {
<<<<<<< HEAD
=======
  [Parameter] public int Id { get; set; }
>>>>>>> 2a4723181eb53793017accd44a8b979eef5239a4
  Tramite t = new();
  int idTramite;
  string error = "";
  bool visible = false;
  CuadroDialogo dialogo = null!;

  protected override void OnInitialized()
  {
    try
    {
      Usuario user = UsuarioConsulta.Ejecutar(Id);
    }
    catch
    {
      Navigation.NavigateTo("/");
    }
  }

  void Consultar(int idTramite)
  {
    try
    {
      t = CasoConsulta.Ejecutar(idTramite);
      visible = true;
      error = "";
    }
    catch (Exception ex)
    {
      visible = false;
      error = ex.Message;
      dialogo.Mostrar();
    }
  }

  void Volver()
  {
    Navigation.NavigateTo($"/home");
  }
}